---
- name: Deploy a VM with cloud-init data
  hosts: localhost
  connection: local
  vars:
    ansible_python_interpreter: "/usr/bin/env python"
  tasks:
    - kubevirt_raw:
       state: present
       name: jhendrix
       namespace: vms
       verify_ssl: no
       inline:
         apiVersion: kubevirt.io/v1alpha1
         kind: VirtualMachine
         metadata:
           name: jhendrix
           namespace: vms
         spec:
           domain:
             resources:
               requests:
                 memory: 512M
             devices:
               disks:
               - volumeName: myvolume
                 name: mydisk
                 disk:
                   bus: virtio
               - name: cloudinitdisk
                 volumeName: cloudinitvolume
                 disk:
                   bus: virtio
           volumes:
           - volumeName: myvolume
             name: myvolume
             persistentVolumeClaim:
               claimName: fedoravm-pvc
           - cloudInitNoCloud:
               userDataBase64: ICNjbG91ZC1jb25maWcKICAgICAgICAgICBob3N0bmFtZTogamhlbmRyaXgKICAgICAgICAgICB1c2VyczoKICAgICAgICAgICAgIC0gbmFtZToga3ViZXZpcnQKICAgICAgICAgICAgICAgZ2Vjb3M6IEt1YmVWaXJ0IFByb2plY3QKICAgICAgICAgICAgICAgc3VkbzogQUxMPShBTEwpIE5PUEFTU1dEOkFMTAogICAgICAgICAgICAgICBzc2hfYXV0aG9yaXplZF9rZXlzOgogICAgICAgICAgICAgICAgICAgLSBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJBUUMrS01wMUY0U3JLaXR2Z0lMZjhRMkdRYmNPc2xJZzRzZnFVT2YrbTgzMnp3b1MyWjJuZG1wci8zRitOdExxNTZjVGFFeks5SVBCSWtOTEpmc1BxUnNUb0xCWVpEK2w0UzVGZnVaMnh3Q3hHQkgrVFZYQXBPK1NpRDZjODRybWpPeDQ3NjY1aVF2TUhLTCtuLzVnVnZTZFlEdWVnTktuajRyUnIvZUhuRzJ5QzRUVlpsM29ISTdUUE9VSlQra0tqU1dQMVVlc1dUWm1tY2szOUlhRlNtb3JnMzFYN2c5aEpId3E5SkVEUWlsY2JuSXlxRFpLaUg2SnU0R2pPVThtcWhhekJGQjRxdS9RRERiMjVwRHBQZDJwUUdCaWxHdm03Z3dKQ1ZueURrOVlaUVU3Z1lFNzM0S0xEZjV0Q0tNbUVRU2p3RngyVGo5bWZadmVDSUprYWozVCBrdWJldmlydAogICAgICAg
             name: cloudinitvolume
